var products={"001":{price:"400",type:"blind",rabate:{3:5,10:10},gapDelimeter:10,priceMeter:[{minHeight:[1,150],priceMin:36,priceCM:.8,gap:9},{minHeight:[151,220],priceMin:46,priceCM:1.2,gap:12.6},{minHeight:[221,250],priceMin:66,priceCM:1.5,gap:17.64}],amount:50,maxHeight:250,name:"Roleta Dzień i Noc"},"002":{price:"400",type:"mini",rabate:{3:5,10:10},gapDelimeter:20,priceWidth:[{distance:[0,80],price:40.2},{distance:[81,100],price:43.2},{distance:[101,120],price:46.2},{distance:[121,140],price:52.2},{distance:[141,160],price:55.2},{distance:[161,180],price:58.2},{distance:[181,200],price:61.2}],priceMeter:[{minHeight:[1,180],priceMin:40.2,minWidth:80,priceCM:.8,gap:9},{minHeight:[181,250],priceMin:46,priceCM:1.2,gap:12.6}],amount:50,maxHeight:250,name:"Roleta ścienna"},"003":{price:"400",type:"blind",rabate:{3:5,10:10},gapDelimeter:10,priceWidth:[{distance:[0,80],price:40.2},{distance:[81,100],price:43.2},{distance:[101,120],price:46.2},{distance:[121,140],price:52.2},{distance:[141,160],price:55.2},{distance:[161,180],price:58.2},{distance:[181,200],price:61.2}],priceMeter:[{minHeight:[1,180],priceMin:40.2,minWidth:80,priceCM:.8,gap:9},{minHeight:[181,250],priceMin:46,priceCM:1.2,gap:12.6}],amount:50,maxHeight:250,name:"Roleta Mini"},"004":{price:"400",type:"blind",subtype:!0,rabate:{3:5,10:10},gapDelimeter:10,priceMeter:[{minHeight:[1,150],priceMin:32,priceCM:.8},{minHeight:[151,220],priceMin:46,priceCM:1.2},{minHeight:[221,250],priceMin:66,priceCM:1.5}],amount:50,maxHeight:250,name:"Roleta Termo"},"005":{price:"400",type:"blind",rabate:{3:5,10:10},gapDelimeter:10,priceMeter:[{minHeight:[1,150],priceMin:36,priceCM:.8,gap:9},{minHeight:[151,220],priceMin:46,priceCM:1.2,gap:12.6},{minHeight:[221,250],priceMin:66,priceCM:1.5,gap:17.64}],amount:50,maxHeight:250,name:"Roleta Mini"}},app={container:null,button:null,selectProduct:null,countItems:null,currency:"zł",step1:null,step2:null,currentItem:null,finalPrice:null,init:function(a){this.container=a,this.setItems(),this.bindFunctions(),this.validForom(),this.step2Form()},countTotalPrice:function(){var a=this.productList.find(".product-item tbody"),b=a.find("tr"),c=0,d=[];$.each(b,function(a,b){c+=parseFloat($(b).find("[data-price]").data("price")),d.push(c)}),this.finalPrice.data("price",c),this.finalPrice.html(String(c).replace(".",",")+this.currency)},showRabate:function(){var a=this.productList.find(".product-item tbody"),b=$("#topPriceRabate");a.find("tr").length>=3?b.removeClass("hidden"):b.addClass("hidden"),a.find("tr").length>=1?(this.productList.find(".product-item thead").removeClass("hidden"),this.productList.find(".alert").hide(),this.orderButton.removeAttr("disabled")):(this.productList.find(".product-item thead").addClass("hidden"),this.productList.find(".alert").show(),this.orderButton.attr("disabled",!0)),this.countTotalPrice()},summary:function(){var a=this,b=0;if($("[data-parsley-form-config]").parsley().validate()===!0){var c=a.currentItem,d=this.itemWidth.val(),e=this.itemHeight.val(),f=this.countItems.val(),g=null,h=1;if("blind"===c.type){for(var i=0;i<c.priceMeter.length;i++)e>=c.priceMeter[i].minHeight[0]&&e<=c.priceMeter[i].minHeight[1]&&(g=c.priceMeter[i]);h=1===d?1:parseInt((d-1)/c.gapDelimeter)+1,b=c.subtype?parseFloat(d*g.priceCM).toFixed(2):parseFloat(h*g.gap*f).toFixed(2),b<g.priceMin&&(b=g.priceMin)}if("mini"===c.type){for(var j=0,k=0;k<c.priceWidth.length;k++)d>=c.priceWidth[k].distance[0]&&d<=c.priceWidth[k].distance[1]&&(j=c.priceWidth[k].price);b=180>=e?j:parseFloat(1.5*j).toFixed(2)}}else console.log("formularz nipoprawnie wypełniony");var l=d+"cm x "+e+"cm";this.addRow(c.name,l,f,b,a.currency),this.container.find("form")[0].reset(),this.container.find("form").parsley().reset()},addRow:function(a,b,c,d,e){var f=this,g=$("<tr>"),h=$("<td>"),i=$("<td>"),j=$("<td>"),k=$("<td>"),l=$('<td><a href="#" class="remove-item"><span class="icon-trash-o"></span></a></td>');g.append(h.text(a)).append(i.text(b)).append(j.text(c)).append(k.text(String(d).replace(".",",")+e).attr("data-price",d)).append(l),l.on("click",function(){var a=$(this);return f.removeRowAction(a),!1}),this.productList.find(".product-item tbody").append(g),this.showRabate()},setItems:function(){this.button=this.container.find("#countPriceButton"),this.selectProduct=this.container.find("#product"),this.finalPrice=$("#finalPrice"),this.countItems=this.container.find("#countItems"),this.dropdown=this.container.find(".dropdown"),this.itemWidth=this.container.find("#itemWidth"),this.itemHeight=this.container.find("#itemHeight"),this.productList=$("#productList"),this.step1=$(".flow-step-1"),this.orderButton=$("#orderFormButton"),this.step2=$(".flow-step-2"),this.backToCalculator=$("#backToCalculator"),this.orderFormButton=$("#orderFormButton")},submit:function(){},setMaxAmount:function(a){this.countItems.attr("max",a)},setMaxHeight:function(a){this.itemHeight.attr("max",a)},checkIfItemSelect:function(){var a=this.dropdown.find("button").attr("data-item-set");return"false"===a?(this.dropdown.find("button").attr("data-original-title","Wybierz produkt"),this.dropdown.parent().addClass("has-error"),this.dropdown.find("button").tooltip("show"),!1):(this.dropdown.find("button").tooltip("destroy"),this.dropdown.parent().removeClass("has-error"),!0)},bindFunctions:function(){function a(a){var c="step1",d="step2";("1"===$(this).attr("data-step")||1===a)&&(c=["step2"],d=["step1"]),b[c].fadeOut("fast",function(){b[d].hide().removeClass("hidden").fadeIn("fast"),b[c].addClass("hidden")})}var b=this;this.button.on("click",function(){return $("[data-parsley-form-config]").parsley().validate(),b.checkIfItemSelect()===!0&&$("[data-parsley-form-config]").parsley().validate()===!0&&b.summary(),!1}),this.orderButton.on("click",a),this.backToCalculator.on("click",a),this.dropdown.find('li[role="presentation"]').on("click",function(){var a=$(this);b.dropdown.find("li").removeClass("active"),a.addClass("active"),b.currentItem=products[a.find("a").data("product-id")],b.dropdown.find("button b").text(a.find("a").text()),b.dropdown.find("button").attr("data-item-set",!0),b.setMaxAmount(b.currentItem.amount),b.setMaxHeight(b.currentItem.maxHeight)}),this.countItems.on("keyup",function(){b.checkIfItemSelect()}),this.productList.find(".remove-item").on("click",function(){var a=$(this);return b.removeRowAction(a),!1})},removeRowAction:function(a){var b=this;a.parents("tr").fadeOut("medium",function(){a.parents("tr").remove(),b.showRabate()})},validForom:function(){var a={errorsContainer:function(a){var b=a.$element.parent().parent().find(".custom-error");return b}};$("[data-parsley-form-config]").length>0&&($("[data-parsley-form-config]").parsley(a),$.listen("parsley:field:error",function(a){var b=a.$element.parent(),c=window.ParsleyUI.getErrorsMessages(a);b.addClass("has-error"),b.attr("data-original-title",c).tooltip("show")}),$.listen("parsley:field:success",function(a){a.$element.parent().tooltip("destroy").removeClass("has-error")}))},helpers:function(){function a(a){a.append(d)}function b(){d.remove()}function c(a){a instanceof $&&$("html,body").animate({scrollTop:a.offset().top},"medium",function(){})}var d=$("<div>",{"class":"loader big"});return{loader:a,removeLoader:b,scrollTo:c}}(),step2Form:function(){function a(a){return isNaN(a)?0:a}var b=$(".contact-form"),c=b.attr("data-action"),d=b.parent(),e=this;b.on("submit",function(){if(b.parsley().validate()){b.find(".recaptcha-wrapper").removeClass("hidden");var f=grecaptcha.getResponse();if(0===f.length)return!1;var g=function(a){d.find(".js-message").hide().removeClass("hidden"),void 0!==a.err?d.find(".js-message").removeClass("alert-info").addClass("alert-danger").hrml("Formularz zawiera błędy:<br>"+a.err).show():void 0!==a.ok&&(d.find(".js-message").addClass("alert-info").removeClass("alert-danger").text("Formularz został wysłany! Wkrótce otrzymasz więcej informacji!").show(),b[0].reset(),b.slideUp(),b.find(".recaptcha-wrapper").addClass("hidden"),setTimeout(function(){window.location.reload()},5e3))},h=$(".product-item.table tbody").clone();h.find("td:last-child").remove();var i=h.html(),j=$("#finalPrice");if(b.find('[name="message"]').val(i),b.find('[name="total"]').val(j.data("price")),a(0===j.data("price")))return console.log("Wystąpił błąd! Suma zamówienia jest błędna"),!1;$.ajax({url:c,data:{data:b.serialize()},type:"POST",dataType:"json",success:function(a){g(a)},beforeSend:function(){e.helpers.loader($(".contact-captcha-wrap"))},error:function(){d.find(".js-message").length>0&&d.find(".js-message").text("Wystąpił błąd!")}}).always(function(){e.helpers.removeLoader()})}return!1})}},recaptchaCallback=function(){$(".contact-form").submit()};app.init($(".form-container"));